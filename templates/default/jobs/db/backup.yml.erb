- schedule:
    time:
      hour: '0'
      minute: '00'
      seconds: '0'
    month: '*'
    year: '*'
    weekday:
      day: '*'
  loglevel: INFO
  sequence:
    keepgoing: false
    strategy: node-first
    commands:
    - exec: pg_dump --format=custom --compress=4 --file=/tmp/<%= @db_name %>.sql --user=<%= @user %> --host=<%= @host %> -w <%= @db_name %>
    - exec: aws s3 cp /tmp/<%= @db_name %>.sql s3://<%= @db_name %>.db/$(date +%Y)/$(date +%m)/$(date +%Y%m%d_%H%M%S).sql
    - exec: rm /tmp/<%= @db_name %>.sql
  description: ''
  notification:
    onfailure:
      recipients: cron+infra@balancedpayments.com
      urls: https://notify.vandelay.io
  nodefilters:
    dispatch:
      threadcount: 1
      keepgoing: false
      excludePrecedence: true
      rankOrder: ascending
    include:
      tags: db-secondary
